var RESULT={HIT:0,MISS:1,DODGE:2,CRIT:3,GLANCE:4},step=0,log=!1,version=2;class Simulation{constructor(e,s,a){this.player=e,this.timesecsmin=parseInt($('input[name="timesecsmin"]').val()),this.timesecsmax=parseInt($('input[name="timesecsmax"]').val()),this.executeperc=parseInt($('input[name="executeperc"]').val()),this.startrage=parseInt($('input[name="startrage"]').val()),this.iterations=parseInt($('input[name="simulations"]').val()),this.idmg=0,this.totaldmg=0,this.totalduration=0,this.mindps=99999,this.maxdps=0,this.maxcallstack=Math.min(Math.floor(this.iterations/10),1e3),this.starttime=0,this.endtime=0,this.cb_update=a,this.cb_finished=s,this.spread=[],this.bloodfurystep=1e3*parseInt(spells[11].time),this.berserkingstep=1e3*parseInt(spells[10].time),this.reckstep=1e3*parseInt(spells[7].time),this.priorityap=parseInt(spells[4].priorityap),log=1==this.iterations}start(){this.run(1),this.starttime=(new Date).getTime()}run(e){step=0,this.idmg=0;let s,a,t=this.player;t.reset(this.startrage),this.maxsteps=rng(1e3*this.timesecsmin,1e3*this.timesecsmax),this.duration=this.maxsteps/1e3,this.executestep=this.maxsteps-parseInt(this.maxsteps*(this.executeperc/100));let l=!1,r=0,i=0;for(t.auras.flask&&(this.flaskstep=Math.max(this.maxsteps-6e4,0),i+=6e4),t.auras.cloudkeeper&&(this.cloudstep=Math.max(this.maxsteps-i-3e4,0),i+=3e4),t.auras.slayer&&(this.slayerstep=Math.max(this.maxsteps-i-2e4,0),i+=2e4),t.auras.spider&&(this.spiderstep=Math.max(this.maxsteps-i-15e3,0),i+=15e3),t.auras.gabbar&&(this.gabbarstep=Math.max(this.maxsteps-i-2e4,0),i+=2e4),t.auras.earthstrike&&(this.earthstep=Math.max(this.maxsteps-i-2e4,0),i+=2e4),t.auras.pummeler&&(this.pummelstep=Math.max(this.maxsteps-i-3e4,0),i+=3e4),t.auras.swarmguard&&(this.swarmstep=Math.max(this.maxsteps-i-3e4,0),i+=3e4),t.auras.zandalarian&&(this.zandalarstep=Math.max(this.maxsteps-i-2e4,0),i+=2e4);step<this.maxsteps;)if(0!=r&&step%3e3==0&&t.talents.angermanagement&&(t.rage=t.rage>=99?100:t.rage+1,l=!0),t.vaelbuff&&0!=r&&step%1e3==0&&(t.rage=t.rage>=80?100:t.rage+20,l=!0),t.mh.timer<=0&&(this.idmg+=t.attackmh(t.mh),l=!0),t.oh&&t.oh.timer<=0&&(this.idmg+=t.attackoh(t.oh),l=!0),l&&!t.spelldelay&&(t.spells.bloodrage&&t.spells.bloodrage.canUse()?(t.spelldelay=1,s=t.spells.bloodrage):t.auras.mightyragepotion&&t.auras.mightyragepotion.canUse()?(t.spelldelay=1,s=t.auras.mightyragepotion):t.timer||(t.auras.flask&&t.auras.flask.canUse()&&step>this.flaskstep?(t.spelldelay=1,s=t.auras.flask):t.auras.cloudkeeper&&t.auras.cloudkeeper.canUse()&&step>this.cloudstep?(t.spelldelay=1,s=t.auras.cloudkeeper):t.auras.recklessness&&t.auras.recklessness.canUse()&&step>this.reckstep?(t.spelldelay=1,s=t.auras.recklessness):t.auras.deathwish&&t.auras.deathwish.canUse()?(t.spelldelay=1,s=t.auras.deathwish):t.auras.bloodfury&&t.auras.bloodfury.canUse()&&step>this.bloodfurystep?(t.spelldelay=1,s=t.auras.bloodfury):t.auras.berserking&&t.auras.berserking.canUse()&&step>this.berserkingstep?(t.spelldelay=1,s=t.auras.berserking):t.auras.slayer&&t.auras.slayer.canUse()&&step>this.slayerstep?(t.spelldelay=1,s=t.auras.slayer):t.auras.spider&&t.auras.spider.canUse()&&step>this.spiderstep?(t.spelldelay=1,s=t.auras.spider):t.auras.gabbar&&t.auras.gabbar.canUse()&&step>this.gabbarstep?(t.spelldelay=1,s=t.auras.gabbar):t.auras.earthstrike&&t.auras.earthstrike.canUse()&&step>this.earthstep?(t.spelldelay=1,s=t.auras.earthstrike):t.auras.pummeler&&t.auras.pummeler.canUse()&&step>this.pummelstep?(t.spelldelay=1,s=t.auras.pummeler):t.auras.swarmguard&&t.auras.swarmguard.canUse()&&step>this.swarmstep?(t.spelldelay=1,s=t.auras.swarmguard):t.auras.zandalarian&&t.auras.zandalarian.canUse()&&step>this.zandalarstep?(t.spelldelay=1,s=t.auras.zandalarian):t.spells.execute&&step>=this.executestep?t.spells.bloodthirst&&t.stats.ap>=this.priorityap&&t.spells.bloodthirst.canUse()?(t.spelldelay=1,s=t.spells.bloodthirst):t.spells.mortalstrike&&t.stats.ap>=this.priorityap&&t.spells.mortalstrike.canUse()?(t.spelldelay=1,s=t.spells.mortalstrike):t.spells.execute.canUse()&&(t.spelldelay=1,s=t.spells.execute):t.spells.sunderarmor&&t.spells.sunderarmor.canUse()?(t.spelldelay=1,s=t.spells.sunderarmor):t.spells.bloodthirst&&t.spells.bloodthirst.canUse()?(t.spelldelay=1,s=t.spells.bloodthirst):t.spells.mortalstrike&&t.spells.mortalstrike.canUse()?(t.spelldelay=1,s=t.spells.mortalstrike):t.spells.whirlwind&&t.spells.whirlwind.canUse()?(t.spelldelay=1,s=t.spells.whirlwind):t.spells.overpower&&t.spells.overpower.canUse()?(t.spelldelay=1,s=t.spells.overpower):t.spells.hamstring&&t.spells.hamstring.canUse()&&(t.spelldelay=1,s=t.spells.hamstring)),t.heroicdelay&&(l=!1)),l&&!t.heroicdelay&&(!t.spells.execute||step<this.executestep?t.spells.heroicstrike&&t.spells.heroicstrike.canUse()&&(t.heroicdelay=1,a=t.spells.heroicstrike):t.spells.heroicstrikeexecute&&t.spells.heroicstrikeexecute.canUse()&&(t.heroicdelay=1,a=t.spells.heroicstrikeexecute),l=!1),t.spelldelay&&s&&t.spelldelay>s.maxdelay&&(t.heroicdelay&&a&&t.heroicdelay>a.maxdelay&&(t.heroicdelay=a.maxdelay-49),s.canUse()?(this.idmg+=t.cast(s),t.spelldelay=0,l=!0):t.spelldelay=0),t.heroicdelay&&a&&t.heroicdelay>a.maxdelay&&(a.canUse()?(t.cast(a),t.heroicdelay=0,l=!0):t.heroicdelay=0),t.spells.heroicstrike&&t.spells.heroicstrike.unqueue&&t.nextswinghs&&t.rage<t.spells.heroicstrike.unqueue&&t.mh.timer<=t.spells.heroicstrike.unqueuetimer&&(this.player.nextswinghs=!1),t.extraattacks>0&&(t.mh.timer=0,t.extraattacks--),t.batchedextras>0&&(t.mh.timer=400-step%400,t.batchedextras--),!t.mh.timer||!t.spelldelay&&l||!t.heroicdelay&&l)r=0;else{if(r=Math.min(t.mh.timer,t.oh?t.oh.timer:9999),t.spelldelay&&s.maxdelay-t.spelldelay<r&&(r=s.maxdelay-t.spelldelay+1),t.heroicdelay&&a.maxdelay-t.heroicdelay<r&&(r=a.maxdelay-t.heroicdelay+1),t.timer&&t.timer<r&&(r=t.timer),t.itemtimer&&t.itemtimer<r&&(r=t.itemtimer),t.talents.angermanagement&&3e3-step%3e3<r&&(r=3e3-step%3e3),t.vaelbuff&&1e3-step%1e3<r&&(r=1e3-step%1e3),t.auras.bloodrage&&t.auras.bloodrage.timer&&1e3-(step-t.auras.bloodrage.starttimer)%1e3<r&&(r=1e3-(step-t.auras.bloodrage.starttimer)%1e3),t.auras.gabbar&&t.auras.gabbar.timer&&2e3-(step-t.auras.gabbar.starttimer)%2e3<r&&(r=2e3-(step-t.auras.gabbar.starttimer)%2e3),t.spells.bloodthirst&&t.spells.bloodthirst.timer&&t.spells.bloodthirst.timer<r&&(r=t.spells.bloodthirst.timer),t.spells.mortalstrike&&t.spells.mortalstrike.timer&&t.spells.mortalstrike.timer<r&&(r=t.spells.mortalstrike.timer),t.spells.whirlwind&&t.spells.whirlwind.timer&&t.spells.whirlwind.timer<r&&(r=t.spells.whirlwind.timer),t.spells.bloodrage&&t.spells.bloodrage.timer&&t.spells.bloodrage.timer<r&&(r=t.spells.bloodrage.timer),t.spells.overpower&&t.spells.overpower.timer&&t.spells.overpower.timer<r&&(r=t.spells.overpower.timer),t.spells.execute&&t.spells.execute.timer&&t.spells.execute.timer<r&&(r=t.spells.execute.timer),t.spells.heroicstrike&&t.spells.heroicstrike.unqueue){let e=Math.max(t.mh.timer-t.spells.heroicstrike.unqueuetimer);e>0&&e<r&&(r=e)}step+=r,t.mh.step(r),t.oh&&t.oh.step(r),t.timer&&t.steptimer(r)&&!t.spelldelay&&(l=!0),t.itemtimer&&t.stepitemtimer(r)&&!t.spelldelay&&(l=!0),t.dodgetimer&&t.stepdodgetimer(r),t.spelldelay&&(t.spelldelay+=r),t.heroicdelay&&(t.heroicdelay+=r),t.spells.bloodthirst&&t.spells.bloodthirst.timer&&!t.spells.bloodthirst.step(r)&&!t.spelldelay&&(l=!0),t.spells.mortalstrike&&t.spells.mortalstrike.timer&&!t.spells.mortalstrike.step(r)&&!t.spelldelay&&(l=!0),t.spells.whirlwind&&t.spells.whirlwind.timer&&!t.spells.whirlwind.step(r)&&!t.spelldelay&&(l=!0),t.spells.bloodrage&&t.spells.bloodrage.timer&&!t.spells.bloodrage.step(r)&&!t.spelldelay&&(l=!0),t.spells.overpower&&t.spells.overpower.timer&&!t.spells.overpower.step(r)&&!t.spelldelay&&(l=!0),t.spells.execute&&t.spells.execute.timer&&!t.spells.execute.step(r)&&!t.spelldelay&&(l=!0),t.auras.bloodrage&&t.auras.bloodrage.timer&&!t.auras.bloodrage.step()&&!t.spelldelay&&(l=!0),t.auras.gabbar&&t.auras.gabbar.timer&&t.auras.gabbar.step()}t.endauras(),this.totaldmg+=this.idmg,this.totalduration+=this.duration;let p=this.idmg/this.duration;if(p<this.mindps&&(this.mindps=p),p>this.maxdps&&(this.maxdps=p),p=Math.round(p),this.spread[p]?this.spread[p]++:this.spread[p]=1,e==this.iterations)this.endtime=(new Date).getTime(),this.cb_finished&&this.cb_finished();else if(e%this.maxcallstack==0){let s=this;this.cb_update&&this.cb_update(e),setTimeout(function(){s.run(e+1)},0)}else this.run(e+1)}}function rng(e,s){return~~(Math.random()*(s-e+1)+e)}function rng10k(){return~~(1e4*Math.random())}function avg(e,s){return(e+s)/2}